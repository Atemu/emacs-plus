<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2015 - Mark C. Feber
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.b
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  -->

<!-- Use alt for alt -->
<keymap name="Mac Emacs+ (mod)" parent="Mac OS X 10.5+" version="1" disable-mnemonics="true">

  <!-- Rebind Intellij commands with alt -->

  <action id="CodeCompletion">
    <keyboard-shortcut first-keystroke="control SPACE"/>
    <keyboard-shortcut first-keystroke="alt SLASH"/>
  </action>
  <action id="SmartTypeCompletion">
    <keyboard-shortcut first-keystroke="control shift SPACE"/>
    <keyboard-shortcut first-keystroke="shift control SPACE"/>
    <keyboard-shortcut first-keystroke="control alt SLASH"/>
  </action>

  <!-- Redefine here to remove conflicts with Sexp commands below -->
  <action id="EditorCodeBlockStart">
    <keyboard-shortcut first-keystroke="meta alt OPEN_BRACKET"/>
    <keyboard-shortcut first-keystroke="control alt U"/>
    <!--<keyboard-shortcut first-keystroke="control alt F"/>-->
  </action>
  <action id="EditorCodeBlockEnd">
    <keyboard-shortcut first-keystroke="meta alt CLOSE_BRACKET"/>
    <keyboard-shortcut first-keystroke="control alt D"/>
    <!--<keyboard-shortcut first-keystroke="control alt B"/>-->
  </action>
  <action id="EditorCodeBlockStartWithSelection">
    <keyboard-shortcut first-keystroke="meta alt shift OPEN_BRACKET"/>
    <keyboard-shortcut first-keystroke="control shift alt U"/>
  </action>
  <action id="EditorCodeBlockEndWithSelection">
    <keyboard-shortcut first-keystroke="meta alt shift CLOSE_BRACKET"/>
    <keyboard-shortcut first-keystroke="control shift alt D"/>
  </action>

  <action id="$Undo">
    <keyboard-shortcut first-keystroke="meta z" />
    <keyboard-shortcut first-keystroke="ctrl slash" />
  </action>
  <action id="Editor Undo">
    <keyboard-shortcut first-keystroke="ctrl slash" />
  </action>

  <!-- Approximate mapping for M-@ mark-word -->
  <action id="EditorSelectWord">
    <keyboard-shortcut first-keystroke="alt AT"/>
    <keyboard-shortcut first-keystroke="alt shift 2"/>
  </action>

  <action id="Emacs+.ForwardWord">
    <keyboard-shortcut first-keystroke="control RIGHT"/>
    <keyboard-shortcut first-keystroke="alt RIGHT"/>
    <keyboard-shortcut first-keystroke="alt F"/>
  </action>
  <action id="Emacs+.BackwardWord">
    <keyboard-shortcut first-keystroke="control LEFT"/>
    <keyboard-shortcut first-keystroke="alt LEFT"/>
    <keyboard-shortcut first-keystroke="alt B"/>
  </action>

  <action id="EditorNextWord">
    <!-- TODO: Temporary binding for forward sexp -->
    <keyboard-shortcut first-keystroke="alt RIGHT"/>
    <keyboard-shortcut first-keystroke="control alt F"/>
    <keyboard-shortcut first-keystroke="control alt F"/>
  </action>
  <action id="EditorPreviousWord">
    <!-- TODO: Temporary binding for backward sexp -->
    <keyboard-shortcut first-keystroke="alt LEFT"/>
    <keyboard-shortcut first-keystroke="control alt B"/>
  </action>

  <!-- Kill related commands -->
  <action id="Emacs+.KillWord">
    <keyboard-shortcut first-keystroke="alt D"/>
    <keyboard-shortcut first-keystroke="control DELETE"/>
    <!-- TODO: Temporary binding for kill sexp -->
    <keyboard-shortcut first-keystroke="control alt K"/>
  </action>
  <action id="Emacs+.KillWordBackward">
    <keyboard-shortcut first-keystroke="alt DELETE"/>
    <!-- for smaller mac keyboards support BACK_SPACE instead of requiring Fn DELETE -->
    <keyboard-shortcut first-keystroke="alt BACK_SPACE"/>
    <keyboard-shortcut first-keystroke="control BACK_SPACE"/>
    <!-- TODO: Temporary binding for backward kill sexp -->
    <keyboard-shortcut first-keystroke="control alt DELETE"/>
    <keyboard-shortcut first-keystroke="control alt BACK_SPACE"/>
  </action>
  <!--<action id="EditorCutLineBackward">-->
  <action id="Emacs+.CutLineBackwardKey">
    <keyboard-shortcut first-keystroke="alt MINUS" second-keystroke="control K"/>
  </action>
  <action id="Emacs+.SaveRegion">
    <keyboard-shortcut first-keystroke="alt W"/>
  </action>
  <action id="Emacs+.AppendNextKill">
    <keyboard-shortcut first-keystroke="control alt W"/>
  </action>

  <action id="GotoLine">
    <keyboard-shortcut first-keystroke="meta L"/>
    <keyboard-shortcut first-keystroke="alt G" second-keystroke="G"/>
    <keyboard-shortcut first-keystroke="alt G" second-keystroke="alt G"/>
  </action>
  <action id="GotoNextError">
    <keyboard-shortcut first-keystroke="alt G" second-keystroke="N"/>
    <keyboard-shortcut first-keystroke="alt G" second-keystroke="alt N"/>
    <keyboard-shortcut first-keystroke="F2"/>
    <keyboard-shortcut first-keystroke="control X" second-keystroke="BACK_QUOTE"/>
  </action>
  <action id="GotoDeclaration">
    <keyboard-shortcut first-keystroke="meta B"/>
    <mouse-shortcut keystroke="meta button1"/>
    <mouse-shortcut keystroke="Force touch" />
    <mouse-shortcut keystroke="button2" />
    <keyboard-shortcut first-keystroke="alt PERIOD"/>
    <mouse-shortcut keystroke="ctrl button1"/>
  </action>
  <action id="GotoImplementation">
    <keyboard-shortcut first-keystroke="control U" second-keystroke="alt PERIOD"/>
  </action>

  <action id="GotoAction">
    <keyboard-shortcut first-keystroke="shift meta a" />
    <keyboard-shortcut first-keystroke="alt X"/>
  </action>

  <action id="EditorPageUp">
    <keyboard-shortcut first-keystroke="page_up" />
    <keyboard-shortcut first-keystroke="alt V"/>
  </action>
  <action id="EditorTextStart">
    <keyboard-shortcut first-keystroke="alt shift COMMA"/>
    <keyboard-shortcut first-keystroke="alt LESS"/>
  </action>
  <action id="EditorTextEnd">
    <keyboard-shortcut first-keystroke="alt shift PERIOD"/>
    <keyboard-shortcut first-keystroke="alt GREATER"/>
  </action>

  <action id="MethodUp">
    <keyboard-shortcut first-keystroke="ctrl shift UP"/>
    <keyboard-shortcut first-keystroke="alt UP"/>
    <keyboard-shortcut first-keystroke="control alt A"/>
  </action>
  <action id="MethodDown">
    <keyboard-shortcut first-keystroke="ctrl shift DOWN"/>
    <keyboard-shortcut first-keystroke="alt UP"/>
    <keyboard-shortcut first-keystroke="control alt E"/>
  </action>
  <action id="FindInPath">
    <keyboard-shortcut first-keystroke="meta shift F"/>
    <keyboard-shortcut first-keystroke="alt S"/>
  </action>
  <action id="FindUsages">
    <keyboard-shortcut first-keystroke="alt F7"/>
  </action>
  <action id="ShowUsages">
    <keyboard-shortcut first-keystroke="control alt F7"/>
    <keyboard-shortcut first-keystroke="alt shift S"/>
  </action>


  <!-- Edit actions rebound by Emacs+ -->
  <action id="EditorJoinLines">
    <keyboard-shortcut first-keystroke="control shift J"/>
    <keyboard-shortcut first-keystroke="control U" second-keystroke="alt shift 6"/>
    <keyboard-shortcut first-keystroke="control U" second-keystroke="alt CIRCUMFLEX"/>
  </action>

  <action id="EmacsStyleIndent">
    <keyboard-shortcut first-keystroke="TAB"/>
    <keyboard-shortcut first-keystroke="alt I"/>
  </action>

  <!-- Rebind Emacs+ commands with alt -->

  <!-- Emacs+ motion commands -->
  <action id="Emacs+.BackToIndentation">
    <keyboard-shortcut first-keystroke="alt M"/>
  </action>

  <!-- Emacs+ edit commands -->
  <action id="Emacs+.CommentDwim">
    <keyboard-shortcut first-keystroke="alt SEMICOLON"/>
    <!-- a convenience binding for lazy fingers -->
    <keyboard-shortcut first-keystroke="control alt SEMICOLON"/>
  </action>
  <action id="Emacs+.CommentKill">
    <keyboard-shortcut first-keystroke="control U" second-keystroke="alt SEMICOLON"/>
    <!-- a convenience binding for lazy fingers -->
    <keyboard-shortcut first-keystroke="control U" second-keystroke="control alt SEMICOLON"/>
  </action>
  <action id="Emacs+.CommentNextLine">
    <keyboard-shortcut first-keystroke="alt N"/>
  </action>
  <action id="Emacs+.CommentPreviousLine">
    <keyboard-shortcut first-keystroke="alt P"/>
  </action>
  <action id="Emacs+.CommentIndentNew">
    <keyboard-shortcut first-keystroke="control alt J"/>
    <keyboard-shortcut first-keystroke="alt J"/>
  </action>

  <action id="Emacs+.DeleteIndentation">
    <keyboard-shortcut first-keystroke="alt shift 6"/>
    <keyboard-shortcut first-keystroke="alt CIRCUMFLEX"/>
  </action>

  <action id="Emacs+.JustOneSpace">
    <keyboard-shortcut first-keystroke="alt SPACE"/>
  </action>
  <action id="Emacs+.DeleteHorizSpace">
    <keyboard-shortcut first-keystroke="alt BACK_SLASH"/>
  </action>
  <action id="Emacs+.YankPop">
    <keyboard-shortcut first-keystroke="alt Y"/>
  </action>

  <action id="Emacs+.CapitalizeWord">
    <keyboard-shortcut first-keystroke="alt C"/>
  </action>
  <action id="Emacs+.DowncaseWord">
    <keyboard-shortcut first-keystroke="alt L"/>
  </action>
  <action id="Emacs+.UpcaseWord">
    <keyboard-shortcut first-keystroke="alt U"/>
  </action>
  <action id="Emacs+.TransposeWords">
    <keyboard-shortcut first-keystroke="alt T"/>
  </action>

  <!-- ISearch actions -->
  <action id="Emacs+.ISearchForwardRegexp">
    <keyboard-shortcut first-keystroke="control alt S"/>
  </action>
  <action id="Emacs+.ISearchBackwardRegexp">
    <keyboard-shortcut first-keystroke="control alt R"/>
  </action>

  <action id="Emacs+.QueryReplace">
    <keyboard-shortcut first-keystroke="shift alt 5"/>
  </action>
  <action id="Emacs+.QueryReplaceRegexp">
    <keyboard-shortcut first-keystroke="shift control alt 5"/>
  </action>

  <!-- ISearch key actions bound to alt -->
  <action id="Emacs+.ISYankLast">
    <keyboard-shortcut first-keystroke="alt Y"/>
  </action>
  <action id="Emacs+.ISYankChar">
    <keyboard-shortcut first-keystroke="control alt Y"/>
  </action>
  <action id="Emacs+.ISDeleteChar">
    <keyboard-shortcut first-keystroke="control alt W"/>
  </action>
  <action id="Emacs+.ISCase">
    <keyboard-shortcut first-keystroke="alt C"/>
  </action>
  <action id="Emacs+.ISMultiLine">
    <keyboard-shortcut first-keystroke="alt M"/>
  </action>
  <action id="Emacs+.ISRegex">
    <keyboard-shortcut first-keystroke="alt R"/>
  </action>
  <action id="Emacs+.ISWords">
    <!-- Inteferes with alt S keystroke in the map as intellij doesn't check if it is enabled in its inInitState keyhandler -->
    <!--<keyboard-shortcut first-keystroke="alt S" second-keystroke="W"/>-->
    <keyboard-shortcut first-keystroke="alt W"/>
  </action>
  <action id="Emacs+.ISearchHistoryPrevious">
    <keyboard-shortcut first-keystroke="alt P"/>
  </action>
  <action id="Emacs+.ISearchHistoryNext">
    <keyboard-shortcut first-keystroke="alt N"/>
  </action>

  <action id="Emacs+.TWScrollDown">
    <keyboard-shortcut first-keystroke="alt V"/>
  </action>
  <action id="Emacs+.TWBegin">
    <keyboard-shortcut first-keystroke="alt shift COMMA"/>
    <keyboard-shortcut first-keystroke="alt LESS"/>
  </action>
  <action id="Emacs+.TWEnd">
    <keyboard-shortcut first-keystroke="alt shift PERIOD"/>
    <keyboard-shortcut first-keystroke="alt GREATER"/>
  </action>

  <!-- Debug actions rebound by Emacs+ -->
  <action id="ToggleLineBreakpoint">
    <keyboard-shortcut first-keystroke="control X" second-keystroke="SPACE"/>

    <keyboard-shortcut first-keystroke="control F8"/>
  </action>
  <action id="StepOver">
    <keyboard-shortcut first-keystroke="control C" second-keystroke="control N"/>

    <keyboard-shortcut first-keystroke="F8"/>
  </action>
  <action id="StepInto">
    <keyboard-shortcut first-keystroke="control C" second-keystroke="control S"/>

    <keyboard-shortcut first-keystroke="F7"/>
  </action>
  <action id="Resume">
    <keyboard-shortcut first-keystroke="control C" second-keystroke="control R"/>

    <keyboard-shortcut first-keystroke="F9"/>
  </action>
  <action id="RunToCursor">
    <keyboard-shortcut first-keystroke="control C" second-keystroke="control U"/>

    <keyboard-shortcut first-keystroke="alt F9"/>
  </action>
  <action id="ToggleTemporaryLineBreakpoint">
    <keyboard-shortcut first-keystroke="control C" second-keystroke="control T"/>

    <keyboard-shortcut first-keystroke="control shift alt F8"/>
  </action>
  <action id="EvaluateExpression">
    <keyboard-shortcut first-keystroke="control C" second-keystroke="control P"/>

    <keyboard-shortcut first-keystroke="alt F8"/>
  </action>

  <!-- Disable intellij conflicts -->
  <action id="EditorDuplicate">
    <!-- <keyboard-shortcut first-keystroke="alt D"/> -->
  </action>

</keymap>
